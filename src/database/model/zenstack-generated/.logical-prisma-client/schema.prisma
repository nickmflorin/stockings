//////////////////////////////////////////////////////////////////////////////////////////////
// DO NOT MODIFY THIS FILE                                                                  //
// This file is automatically generated by ZenStack CLI and should not be manually updated. //
//////////////////////////////////////////////////////////////////////////////////////////////

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

generator client {
  provider = "prisma-client-js"
  output   = "../model/zenstack-generated/.logical-prisma-client"
}

enum ElementAttribute {
  HREF
  SRC
  VALUE
  DATA_GA_PRODUCT_NAME
}

enum ScrapingErrorCode {
  MISSING_ATTRIBUTE
  INVALID_ATTRIBUTE
  MISSING_TEXT
  INVALID_TEXT
  NONUNIQUE_TEXT
  MISSING_ELEMENT
  NONUNIQUE_ELEMENT
  HTTP_NETWORK
  HTTP_CLIENT
  HTTP_SERIALIZATION
}

enum ProductRecordDataField {
  PRICE
  RAW_PRICE
  STATUS
}

enum ProductStatus {
  OutOfStock
  InStock
  AvailableForBackorder
  NotListed
}

enum ProductCategory {
  HandTools
}

enum ProductSubCategory {
  HandPlanes
  Saws
  Chisels
  Spokeshaves
  GreenWoodworking
  AccessoryTools
}

enum PriceChangeEventType {
  PriceIncrease
  PriceDecrease
}

enum NotificationContentType {
  PriceChangeNotification
  StatusChangeNotification
}

model User {
  id                                                    String                     @id() @default(uuid()) @db.Uuid()
  clerkId                                               String                     @unique()
  firstName                                             String
  lastName                                              String
  profileImageUrl                                       String?
  emailAddress                                          String
  createdAt                                             DateTime                   @default(now())
  updatedAt                                             DateTime                   @updatedAt()
  createdProducts                                       Product[]                  @relation("createdProducts")
  updatedProducts                                       Product[]                  @relation("updatedProducts")
  createdProductRecords                                 ProductRecord[]            @relation("createdProductRecords")
  updatedProductRecords                                 ProductRecord[]            @relation("updatedProductRecords")
  createdNotifications                                  Notification[]             @relation("createdNotifications")
  updatedNotifications                                  Notification[]             @relation("updatedNotifications")
  notifications                                         Notification[]             @relation("notifications")
  delegate_aux_User_createdNotifications_PriceChangeN_0 PriceChangeNotification[]  @relation("createdNotifications")
  delegate_aux_User_createdNotifications_StatusChange_0 StatusChangeNotification[] @relation("createdNotifications")
  delegate_aux_User_updatedNotifications_PriceChangeN_0 PriceChangeNotification[]  @relation("updatedNotifications")
  delegate_aux_User_updatedNotifications_StatusChange_0 StatusChangeNotification[] @relation("updatedNotifications")
  delegate_aux_User_notifications_PriceChangeNotifica_0 PriceChangeNotification[]  @relation("notifications")
  delegate_aux_User_notifications_StatusChangeNotific_0 StatusChangeNotification[] @relation("notifications")
}

model HttpNetworkErrorData {
  id  String @id() @default(uuid()) @db.Uuid()
  url String
}

model HttpSerializationErrorData {
  id  String @id() @default(uuid()) @db.Uuid()
  url String
}

model HttpClientErrorData {
  id     String @id() @default(uuid()) @db.Uuid()
  url    String
  status Int
}

model MissingAttributeErrorData {
  id         String           @id() @default(uuid()) @db.Uuid()
  attribute  ElementAttribute
  parentHtml String?
}

model InvalidAttributeErrorData {
  id         String           @id() @default(uuid()) @db.Uuid()
  attribute  ElementAttribute
  parentHtml String?
  value      String
}

model InvalidTextErrorData {
  id         String  @id() @default(uuid()) @db.Uuid()
  parentHtml String?
  value      String
}

model MissingTextErrorData {
  id         String  @id() @default(uuid()) @db.Uuid()
  parentHtml String?
}

model NonUniqueTextErrorData {
  id         String  @id() @default(uuid()) @db.Uuid()
  parentHtml String?
}

model MissingElementErrorData {
  id         String  @id() @default(uuid()) @db.Uuid()
  parentHtml String?
  selector   String
}

model NonUniqueElementErrorData {
  id         String  @id() @default(uuid()) @db.Uuid()
  parentHtml String?
  selector   String
}

model ProductRecordError {
  id        String                 @id() @default(uuid()) @db.Uuid()
  errorId   String                 @unique() @db.Uuid()
  errorCode ScrapingErrorCode
  record    ProductRecord          @relation("errors", fields: [recordId], references: [id])
  recordId  String                 @unique() @db.Uuid()
  field     ProductRecordDataField
  message   String
}

model ProductRecord {
  id                    String                   @id() @default(uuid()) @db.Uuid()
  createdAt             DateTime                 @default(now())
  createdById           String                   @db.Uuid()
  updatedAt             DateTime                 @updatedAt()
  updatedById           String                   @db.Uuid()
  timestamp             DateTime                 @default(now())
  createdBy             User                     @relation("createdProductRecords", fields: [createdById], references: [id])
  updatedBy             User                     @relation("updatedProductRecords", fields: [updatedById], references: [id])
  product               Product                  @relation("records", fields: [productId], references: [id])
  productId             String                   @db.Uuid()
  price                 Float?
  rawPrice              String?
  status                ProductStatus?
  wasManuallyCreated    Boolean                  @default(false)
  manuallyChangedFields ProductRecordDataField[] @default([])
  errors                ProductRecordError[]     @relation("errors")
}

model Product {
  id                                                    String                     @id() @default(uuid()) @db.Uuid()
  createdAt                                             DateTime                   @default(now())
  createdById                                           String                     @db.Uuid()
  updatedAt                                             DateTime                   @updatedAt()
  updatedById                                           String                     @db.Uuid()
  createdBy                                             User                       @relation("createdProducts", fields: [createdById], references: [id])
  updatedBy                                             User                       @relation("updatedProducts", fields: [updatedById], references: [id])
  name                                                  String?
  slug                                                  String                     @unique()
  code                                                  String?
  imageSrc                                              String?
  records                                               ProductRecord[]            @relation("records")
  status                                                ProductStatus?
  statusRecordedAt                                      DateTime?
  price                                                 Float?
  priceRecordedAt                                       DateTime?
  category                                              ProductCategory
  subCategories                                         ProductSubCategory[]
  notifications                                         Notification[]             @relation("notifications")
  delegate_aux_Product_notifications_PriceChangeNotif_0 PriceChangeNotification[]  @relation("notifications")
  delegate_aux_Product_notifications_StatusChangeNoti_0 StatusChangeNotification[] @relation("notifications")
}

/// @@delegate(contentType)
model Notification {
  id          String                  @id() @default(uuid()) @db.Uuid()
  createdAt   DateTime                @default(now())
  createdById String                  @db.Uuid()
  updatedAt   DateTime                @updatedAt()
  updatedById String                  @db.Uuid()
  createdBy   User                    @relation("createdNotifications", fields: [createdById], references: [id])
  updatedBy   User                    @relation("updatedNotifications", fields: [updatedById], references: [id])
  product     Product                 @relation("notifications", fields: [productId], references: [id])
  productId   String                  @db.Uuid()
  user        User                    @relation("notifications", fields: [userId], references: [id])
  userId      String                  @db.Uuid()
  contentType NotificationContentType
  enabled     Boolean                 @default(true)

  @@unique([productId, userId, contentType])
}

model PriceChangeNotification {
  id          String                  @id() @default(uuid()) @db.Uuid()
  createdAt   DateTime                @default(now())
  createdById String                  @db.Uuid()
  updatedAt   DateTime                @updatedAt()
  updatedById String                  @db.Uuid()
  createdBy   User                    @relation("createdNotifications", fields: [createdById], references: [id])
  updatedBy   User                    @relation("updatedNotifications", fields: [updatedById], references: [id])
  product     Product                 @relation("notifications", fields: [productId], references: [id])
  productId   String                  @db.Uuid()
  user        User                    @relation("notifications", fields: [userId], references: [id])
  userId      String                  @db.Uuid()
  contentType NotificationContentType
  enabled     Boolean                 @default(true)
  events      PriceChangeEventType[]  @default([PriceIncrease, PriceDecrease])
}

model StatusChangeNotificationEvent {
  id             String                   @id() @default(uuid()) @db.Uuid()
  fromStatus     ProductStatus[]
  toStatus       ProductStatus[]
  notification   StatusChangeNotification @relation("events", fields: [notificationId], references: [id])
  notificationId String                   @db.Uuid()
}

model StatusChangeNotification {
  id          String                          @id() @default(uuid()) @db.Uuid()
  createdAt   DateTime                        @default(now())
  createdById String                          @db.Uuid()
  updatedAt   DateTime                        @updatedAt()
  updatedById String                          @db.Uuid()
  createdBy   User                            @relation("createdNotifications", fields: [createdById], references: [id])
  updatedBy   User                            @relation("updatedNotifications", fields: [updatedById], references: [id])
  product     Product                         @relation("notifications", fields: [productId], references: [id])
  productId   String                          @db.Uuid()
  user        User                            @relation("notifications", fields: [userId], references: [id])
  userId      String                          @db.Uuid()
  contentType NotificationContentType
  enabled     Boolean                         @default(true)
  events      StatusChangeNotificationEvent[] @relation("events")
}
